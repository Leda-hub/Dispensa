<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Dispensa di Casa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 0; padding: 16px; background: #f5f5f5; }
    h1 { font-size: 22px; margin-bottom: 12px; }
    .card { background: #fff; border-radius: 10px; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .row { display: flex; gap: 8px; margin-bottom: 8px; }
    input, button { font-size: 15px; padding: 6px 8px; border-radius: 6px; border: 1px solid #ccc; }
    button.primary { background: #007aff; color: #fff; border-color: #007aff; }
    .items { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; margin-top: 12px; }
    .item { background: #fff; border-radius: 10px; padding: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); font-size: 13px; }
    .item-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:4px; }
    .badge { width:10px; height:10px; border-radius:999px; margin-right:4px; display:inline-block; }
    .controls { display:flex; gap:4px; align-items:center; }
    .btn-circle { width:20px; height:20px; border-radius:999px; border:none; color:#fff; font-size:12px; line-height:20px; padding:0; text-align:center; }
    .btn-minus { background:#ff3b30; }
    .btn-plus { background:#34c759; }
    .trash { background:none; border:none; color:#ff3b30; font-size:14px; padding:0; cursor:pointer; }
    .meta { font-size:11px; color:#666; margin-top:4px; }
  </style>
</head>
<body>
  <h1>Dispensa di Casa</h1>

  <div class="card">
    <div class="row">
      <input id="nome" type="text" placeholder="Nome alimento" style="flex:2" />
      <input id="quantita" type="number" min="1" value="1" style="width:70px" />
    </div>
    <div class="row">
      <input id="scadenza" type="date" style="flex:1" />
      <button class="primary" onclick="aggiungi()">Aggiungi</button>
    </div>
  </div>

  <div class="items" id="lista"></div>

  <script>
    const STORAGE_KEY = "dispensa_inventario_v1";
    let inventario = [];

    function carica() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try { inventario = JSON.parse(raw); } catch { inventario = []; }
      }
      render();
    }

    function salva() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(inventario));
    }

    function aggiungi() {
      const nome = document.getElementById("nome").value.trim();
      const q = parseInt(document.getElementById("quantita").value || "1", 10);
      const d = document.getElementById("scadenza").value; // yyyy-MM-dd

      if (!nome) return;
      const item = {
        id: Date.now(),
        nome,
        quantita: q > 0 ? q : 1,
        scadenza: d || null,
        dataAggiunta: new Date().toISOString()
      };
      inventario.push(item);
      salva();
      render();

      document.getElementById("nome").value = "";
      document.getElementById("quantita").value = "1";
      document.getElementById("scadenza").value = "";
    }

    function aumenta(id) {
      const item = inventario.find(i => i.id === id);
      if (!item) return;
      item.quantita += 1;
      salva();
      render();
    }

    function diminuisci(id) {
      const idx = inventario.findIndex(i => i.id === id);
      if (idx === -1) return;
      if (inventario[idx].quantita > 1) {
        inventario[idx].quantita -= 1;
      } else {
        inventario.splice(idx, 1);
      }
      salva();
      render();
    }

    function elimina(id) {
      inventario = inventario.filter(i => i.id !== id);
      salva();
      render();
    }

    function coloreBadge(item) {
      if (!item.scadenza) return "#34c759"; // verde
      const oggi = new Date();
      oggi.setHours(0,0,0,0);
      const d = new Date(item.scadenza);
      d.setHours(0,0,0,0);
      const diff = (d - oggi) / (1000*60*60*24);
      if (diff < 0) return "#ff3b30";      // rosso
      if (diff <= 2) return "#ff9500";     // arancione
      if (diff <= 7) return "#ffcc00";     // giallo
      return "#34c759";                    // verde
    }

    function formatData(it) {
      if (!it.scadenza) return "Scadenza: -";
      const d = new Date(it.scadenza);
      return "Scadenza: " + d.toLocaleDateString("it-IT");
    }

    function render() {
      const lista = document.getElementById("lista");
      lista.innerHTML = "";
      inventario
        .slice()
        .sort((a,b) => new Date(a.dataAggiunta) - new Date(b.dataAggiunta))
        .forEach(it => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <div class="item-header">
              <div>
                <span class="badge" style="background:${coloreBadge(it)}"></span>
                <strong>${it.nome}</strong>
              </div>
              <button class="trash" onclick="elimina(${it.id})">ðŸ—‘</button>
            </div>
            <div class="controls">
              <span>Qt: ${it.quantita}</span>
              <button class="btn-circle btn-minus" onclick="diminuisci(${it.id})">âˆ’</button>
              <button class="btn-circle btn-plus" onclick="aumenta(${it.id})">+</button>
            </div>
            <div class="meta">${formatData(it)}</div>
          `;
          lista.appendChild(div);
        });
    }

    carica();
  </script>
</body>
</html>
